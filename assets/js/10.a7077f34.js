(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{366:function(t,_,e){"use strict";e.r(_);var v=e(42),d=Object(v.a)({},(function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"resource-aggregate"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#resource-aggregate"}},[t._v("#")]),t._v(" Resource aggregate")]),t._v(" "),e("h2",{attrs:{id:"description"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#description"}},[t._v("#")]),t._v(" Description")]),t._v(" "),e("p",[t._v("According to CQRS pattern it translates commands to events, store them to DB and publish them to messaging system.")]),t._v(" "),e("h2",{attrs:{id:"docker-image"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-image"}},[t._v("#")]),t._v(" Docker Image")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("docker pull plgd/resource-aggregate:vnext\n")])])]),e("h2",{attrs:{id:"api"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#api"}},[t._v("#")]),t._v(" API")]),t._v(" "),e("p",[t._v("All requests to service must contains valid access token in "),e("a",{attrs:{href:"https://github.com/grpc/grpc-go/blob/master/Documentation/grpc-auth-support.md#oauth2",target:"_blank",rel:"noopener noreferrer"}},[t._v("grpc metadata"),e("OutboundLink")],1),t._v(". Any success command creates event and it can create additional snapshot event. The event is stored in DB and published via messaging system.")]),t._v(" "),e("h3",{attrs:{id:"commands"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#commands"}},[t._v("#")]),t._v(" Commands")]),t._v(" "),e("ul",[e("li",[t._v("publish resource - create resource/republish of the device")]),t._v(" "),e("li",[t._v("unpublish resource - unpublish resource from the cloud")]),t._v(" "),e("li",[t._v("notify resource changed - set/update content of the resource in the cloud")]),t._v(" "),e("li",[t._v("update resource - request to update resource in the device via cloud")]),t._v(" "),e("li",[t._v("confirm resource update - response to update resource request")]),t._v(" "),e("li",[t._v("retrieve resource - request to retrieve resource from the device via cloud")]),t._v(" "),e("li",[t._v("confirm resource retrieve - response to retrieve resource request")])]),t._v(" "),e("h3",{attrs:{id:"contract"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#contract"}},[t._v("#")]),t._v(" Contract")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://github.com/plgd-dev/cloud/blob/master/resource-aggregate/pb/service.proto",target:"_blank",rel:"noopener noreferrer"}},[t._v("service"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/plgd-dev/cloud/blob/master/resource-aggregate/pb/commands.proto",target:"_blank",rel:"noopener noreferrer"}},[t._v("requets/responses"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/plgd-dev/cloud/blob/master/resource-aggregate/pb/events.proto",target:"_blank",rel:"noopener noreferrer"}},[t._v("events"),e("OutboundLink")],1)])]),t._v(" "),e("h2",{attrs:{id:"configuration"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configuration"}},[t._v("#")]),t._v(" Configuration")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("Option")]),t._v(" "),e("th",[t._v("ENV variable")]),t._v(" "),e("th",[t._v("Type")]),t._v(" "),e("th",[t._v("Description")]),t._v(" "),e("th",[t._v("Default")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("ADDRESS")])]),t._v(" "),e("td",[t._v("string")]),t._v(" "),e("td",[e("code",[t._v("listen address")])]),t._v(" "),e("td",[e("code",[t._v('"0.0.0.0:9100"')])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("AUTH_SERVER_ADDRESS")])]),t._v(" "),e("td",[t._v("string")]),t._v(" "),e("td",[e("code",[t._v("authoriztion server address")])]),t._v(" "),e("td",[e("code",[t._v('"127.0.0.1:9100"')])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("SNAPSHOT_THRESHOLD")])]),t._v(" "),e("td",[t._v("int")]),t._v(" "),e("td",[e("code",[t._v("number of events to spawn snapshot event")])]),t._v(" "),e("td",[e("code",[t._v("128")])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("OCC_MAX_RETRY")])]),t._v(" "),e("td",[t._v("int")]),t._v(" "),e("td",[e("code",[t._v("maximum tries to store event to db")])]),t._v(" "),e("td",[e("code",[t._v("8")])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("JWKS_URL")])]),t._v(" "),e("td",[t._v("string")]),t._v(" "),e("td",[e("code",[t._v("url to get JSON Web Key")])]),t._v(" "),e("td",[e("code",[t._v('""')])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("NATS_URL")])]),t._v(" "),e("td",[t._v("string")]),t._v(" "),e("td",[e("code",[t._v("url to nats messaging system")])]),t._v(" "),e("td",[e("code",[t._v('"nats://localhost:4222"')])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("MONGODB_URI")])]),t._v(" "),e("td",[t._v("string")]),t._v(" "),e("td",[e("code",[t._v("uri to mongo database")])]),t._v(" "),e("td",[e("code",[t._v('"mongodb://localhost:27017"')])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("MONGODB_DATABASE")])]),t._v(" "),e("td",[t._v("string")]),t._v(" "),e("td",[e("code",[t._v("name of database")])]),t._v(" "),e("td",[e("code",[t._v('"eventstore"')])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("MONGODB_BATCH_SIZE")])]),t._v(" "),e("td",[t._v("int")]),t._v(" "),e("td",[e("code",[t._v("maximum number resources in one batch request")])]),t._v(" "),e("td",[e("code",[t._v("16")])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("MONGODB_MAX_POOL_SIZE")])]),t._v(" "),e("td",[t._v("int")]),t._v(" "),e("td",[e("code",[t._v("maximum parallel request to DB")])]),t._v(" "),e("td",[e("code",[t._v("16")])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("MONGODB_MAX_CONN_IDLE_TIME")])]),t._v(" "),e("td",[t._v("string")]),t._v(" "),e("td",[e("code",[t._v("maximum time of idle connection")])]),t._v(" "),e("td",[e("code",[t._v('"240s"')])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("DIAL_TYPE")])]),t._v(" "),e("td",[t._v("string")]),t._v(" "),e("td",[e("code",[t._v("defines how to obtain dial TLS certificates - options: acme|file")])]),t._v(" "),e("td",[e("code",[t._v('"acme"')])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("DIAL_ACME_CA_POOL")])]),t._v(" "),e("td",[t._v("string")]),t._v(" "),e("td",[e("code",[t._v("path to pem file of CAs")])]),t._v(" "),e("td",[e("code",[t._v('""')])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("DIAL_ACME_DIRECTORY_URL")])]),t._v(" "),e("td",[t._v("string")]),t._v(" "),e("td",[e("code",[t._v("url of acme directory")])]),t._v(" "),e("td",[e("code",[t._v('""')])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("DIAL_ACME_DOMAINS")])]),t._v(" "),e("td",[t._v("string")]),t._v(" "),e("td",[e("code",[t._v("list of domains for which will be in certificate provided from acme")])]),t._v(" "),e("td",[e("code",[t._v('""')])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("DIAL_ACME_REGISTRATION_EMAIL")])]),t._v(" "),e("td",[t._v("string")]),t._v(" "),e("td",[e("code",[t._v("registration email for acme")])]),t._v(" "),e("td",[e("code",[t._v('""')])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("DIAL_ACME_TICK_FREQUENCY")])]),t._v(" "),e("td",[t._v("string")]),t._v(" "),e("td",[e("code",[t._v("interval of validate certificate")])]),t._v(" "),e("td",[e("code",[t._v('""')])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("DIAL_ACME_USE_SYSTEM_CERTIFICATION_POOL")])]),t._v(" "),e("td",[t._v("bool")]),t._v(" "),e("td",[e("code",[t._v("load CAs from system")])]),t._v(" "),e("td",[e("code",[t._v("false")])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("DIAL_FILE_CA_POOL")])]),t._v(" "),e("td",[t._v("string")]),t._v(" "),e("td",[e("code",[t._v("path to pem file of CAs")])]),t._v(" "),e("td",[e("code",[t._v('""')])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("DIAL_FILE_CERT_KEY_NAME")])]),t._v(" "),e("td",[t._v("string")]),t._v(" "),e("td",[e("code",[t._v("name of pem certificate key file")])]),t._v(" "),e("td",[e("code",[t._v('""')])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("DIAL_FILE_CERT_DIR_PATH")])]),t._v(" "),e("td",[t._v("string")]),t._v(" "),e("td",[e("code",[t._v("path to directory which contains DIAL_FILE_CERT_KEY_NAME and DIAL_FILE_CERT_NAME")])]),t._v(" "),e("td",[e("code",[t._v('""')])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("DIAL_FILE_CERT_NAME")])]),t._v(" "),e("td",[t._v("string")]),t._v(" "),e("td",[e("code",[t._v("name of pem certificate file")])]),t._v(" "),e("td",[e("code",[t._v('""')])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("DIAL_FILE_USE_SYSTEM_CERTIFICATION_POOL")])]),t._v(" "),e("td",[t._v("bool")]),t._v(" "),e("td",[e("code",[t._v("load CAs from system")])]),t._v(" "),e("td",[e("code",[t._v("false")])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("LISTEN_TYPE")])]),t._v(" "),e("td",[t._v("string")]),t._v(" "),e("td",[e("code",[t._v("defines how to obtain listen TLS certificates - options: acme|file")])]),t._v(" "),e("td",[e("code",[t._v('"acme"')])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("LISTEN_ACME_CA_POOL")])]),t._v(" "),e("td",[t._v("string")]),t._v(" "),e("td",[e("code",[t._v("path to pem file of CAs")])]),t._v(" "),e("td",[e("code",[t._v('""')])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("LISTEN_ACME_DIRECTORY_URL")])]),t._v(" "),e("td",[t._v("string")]),t._v(" "),e("td",[e("code",[t._v("url of acme directory")])]),t._v(" "),e("td",[e("code",[t._v('""')])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("LISTEN_ACME_DOMAINS")])]),t._v(" "),e("td",[t._v("string")]),t._v(" "),e("td",[e("code",[t._v("list of domains for which will be in certificate provided from acme")])]),t._v(" "),e("td",[e("code",[t._v('""')])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("LISTEN_ACME_REGISTRATION_EMAIL")])]),t._v(" "),e("td",[t._v("string")]),t._v(" "),e("td",[e("code",[t._v("registration email for acme")])]),t._v(" "),e("td",[e("code",[t._v('""')])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("LISTEN_ACME_TICK_FREQUENCY")])]),t._v(" "),e("td",[t._v("string")]),t._v(" "),e("td",[e("code",[t._v("interval of validate certificate")])]),t._v(" "),e("td",[e("code",[t._v('""')])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("LISTEN_ACME_USE_SYSTEM_CERTIFICATION_POOL")])]),t._v(" "),e("td",[t._v("bool")]),t._v(" "),e("td",[e("code",[t._v("load CAs from system")])]),t._v(" "),e("td",[e("code",[t._v("false")])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("LISTEN_FILE_CA_POOL")])]),t._v(" "),e("td",[t._v("string")]),t._v(" "),e("td",[e("code",[t._v("path to pem file of CAs")])]),t._v(" "),e("td",[e("code",[t._v('""')])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("LISTEN_FILE_CERT_KEY_NAME")])]),t._v(" "),e("td",[t._v("string")]),t._v(" "),e("td",[e("code",[t._v("name of pem certificate key file")])]),t._v(" "),e("td",[e("code",[t._v('""')])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("LISTEN_FILE_CERT_DIR_PATH")])]),t._v(" "),e("td",[t._v("string")]),t._v(" "),e("td",[e("code",[t._v("path to directory which contains LISTEN_FILE_CERT_KEY_NAME and LISTEN_FILE_CERT_NAME")])]),t._v(" "),e("td",[e("code",[t._v('""')])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("LISTEN_FILE_CERT_NAME")])]),t._v(" "),e("td",[t._v("string")]),t._v(" "),e("td",[e("code",[t._v("name of pem certificate file")])]),t._v(" "),e("td",[e("code",[t._v('""')])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("LISTEN_FILE_USE_SYSTEM_CERTIFICATION_POOL")])]),t._v(" "),e("td",[t._v("bool")]),t._v(" "),e("td",[e("code",[t._v("load CAs from system")])]),t._v(" "),e("td",[e("code",[t._v("false")])])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("-")])]),t._v(" "),e("td",[e("code",[t._v("LOG_ENABLE_DEBUG")])]),t._v(" "),e("td",[t._v("bool")]),t._v(" "),e("td",[e("code",[t._v("debug logging")])]),t._v(" "),e("td",[e("code",[t._v("false")])])])])])])}),[],!1,null,null,null);_.default=d.exports}}]);